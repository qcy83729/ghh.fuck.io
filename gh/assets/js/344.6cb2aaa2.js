"use strict";(self["webpackChunkinvestment_advisor_fe"]=self["webpackChunkinvestment_advisor_fe"]||[]).push([[344],{2344:function(t,e,i){i.d(e,{Z:function(){return E}});var s=function(){var t=this,e=t._self._c;return e("van-pull-refresh",{staticClass:"u-p-l-16 u-p-r-16",on:{refresh:t.onRefresh},model:{value:t.listRefresh,callback:function(e){t.listRefresh=e},expression:"listRefresh"}},[e("van-list",{attrs:{finished:t.listFinished,"finished-text":"没有更多内容了",error:t.listError,"error-text":"请求失败，点击重新加载","immediate-check":!1},on:{"update:error":function(e){t.listError=e},load:t.onLoad},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.list,(function(i){return e("video-card",{key:i.ROW_ID,ref:"videoCardRef",refInFor:!0,attrs:{id:i.id,title:i.title,content:i.abs,url:i.link,poster:i.cover,"data-id":i.id},on:{"video-play":t.onVideoPlay}})})),1)],1)},n=[],o=i(8534),r=i(4648),l=(i(7902),i(914)),a=(i(3796),i(8286)),d=(i(7658),i(3948),i(629)),h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"video-card",on:{click:t.handleClick}},[e("video-player",{ref:"videoPlayer",staticClass:"vp",attrs:{url:t.url,width:"100%",height:245,"video-options":t.videoOptions},on:{"video-play":t.onVideoPlay},scopedSlots:t._u([{key:"info",fn:function(){return[e("muted-btn",{staticClass:"btn-volume",attrs:{muted:t.videoMuted},on:{"btn-click":t.toggleMuted}}),e("share-btn",{staticClass:"btn-share",attrs:{title:t.title,content:t.content,cover:t.poster,url:t.shareUrl}})]},proxy:!0}])}),e("div",{staticClass:"u-p-t-10"},[e("div",{staticClass:"u-font-15 color-black"},[t._v(t._s(t.title))]),e("div",{staticClass:"u-flex u-font-12 u-row-center"},[e("div",{staticClass:"u-flex-1 color-gray u-p-b-16"},[t._v(" "+t._s(t.formatContent)+" ")]),t.enableExpand?e("div",{staticClass:"color-dark btn-expand u-p-b-16",on:{click:function(e){return e.stopPropagation(),t.openPopup.apply(null,arguments)}}},[t._v(" 查看全文 ")]):t._e()])]),e("van-popup",{style:{height:"250px"},attrs:{position:"bottom","get-container":"body",closeable:"",round:"","safe-area-inset-bottom":!0},model:{value:t.popupShow,callback:function(e){t.popupShow=e},expression:"popupShow"}},[e("div",{staticClass:"popup-title color-black"},[t._v("正文")]),e("div",{staticClass:"popup-content color-gray"},[t._v(t._s(t.content))])])],1)},c=[],u=(i(3474),i(4755)),p=(i(8838),i(1392)),f=i(8180),g=i(7558),v=i(9376),m={name:"VideoCard",components:{VideoPlayer:f.Z,MutedBtn:g.Z,ShareBtn:v.Z,[p.Z.name]:p.Z,[u.Z.name]:u.Z},props:{id:{type:[String,Number],default:""},url:{type:String,default:""},title:{type:String,default:""},content:{type:String,default:""},poster:{type:String,default:""}},data(){var t;return{videoOptions:{playsinline:!0,poster:null!==(t=this.poster)&&void 0!==t?t:null,closeVideoStopPropagation:!0,closeVideoPreventDefault:!0,closePlayVideoFocus:!0,closeFocusVideoFocus:!0,errorTips:"<span>视频加载失败，请刷新试试</span>",controls:!1},stageHeight:0,contentHeight:0,videoMuted:null,popupShow:!1}},computed:{enableExpand(){return this.content.length>=20},formatContent(){return this.enableExpand?this.content.substring(0,20)+"...":this.content},shareUrl(){let t=location.href;return t=t.substring(0,t.indexOf("#")),t+=`#/story-video?id=${this.id}`,t}},methods:{pauseVideo(){this.$refs.videoPlayer.getPlayer().pause()},isPlaying(){const t=this.$refs.videoPlayer.getPlayer();return t.hasStart},playMutedVideo(){null===this.videoMuted&&this.setVideoOption({muted:!0,autoplay:!0}),this.$refs.videoPlayer.play()},onVideoPlay(){this.$emit("video-play",this.id)},setVideoOption(t){this.$refs.videoPlayer.setVideoOption(t)},handleClick(){const t=this.$refs.videoPlayer.getPlayer();this.$router.push({path:"/story-video",query:{id:this.id,currentTime:t.currentTime,duration:t.duration}})},toggleMuted(){const t=this.$refs.videoPlayer.getPlayer();this.videoMuted=!t.muted,this.setVideoOption({muted:!t.muted})},openPopup(){this.popupShow=!0}}},y=m,b=i(1001),S=(0,b.Z)(y,h,c,!1,null,"3ad4cefe",null),x=S.exports,k=i(4680),C=i(2325),T={name:"VideoList",components:{[a.Z.name]:a.Z,[l.Z.name]:l.Z,VideoCard:x},props:{},data(){return{list:[],listLoaded:!1,currentPage:1,listRefresh:!1,listLoading:!1,listFinished:!1,listError:!1,scrollObserver:null,videoCards:[]}},computed:(0,r.Z)({},(0,d.rn)("user",["mobile"])),created(){this.listLoading=!0,this.getData()},mounted(){this.bindScrollEvent(),window.addEventListener("scroll",this.bindWindowScroll)},beforeDestroy(){this.scrollObserver.disconnect(),window.removeEventListener("scroll",this.bindWindowScroll)},methods:{onLoad(){this.getData()},onRefresh(){this.reset(),this.getData(!0)},reset(){this.unobserveDom(),this.listError=!1,this.currentPage=1,this.pauseAllVideo()},getData(t=!1){var e=this;return(0,o.Z)((function*(){try{const s=yield(0,k.Wt)({page_size:10,phone:e.mobile,page_no:e.currentPage});if(null!==s&&void 0!==s&&s.success){var i;const n=null!==(i=null===s||void 0===s?void 0:s.data)&&void 0!==i?i:[],o=s.total;t?e.list=n:e.list.push(...n),e.listFinished=e.list.length>=o||!n.length,e.list.length<o&&(e.currentPage=e.currentPage+1)}else e.listError=!0}catch(s){e.listError=!0}finally{e.listLoading=!1,e.listRefresh=!1,e.listLoaded=!0,e.$emit("list-load",{listLength:e.list.length,listLoaded:e.listLoaded}),e.observeDom()}}))()},bindScrollEvent(){window.IntersectionObserver?this.listenScroll():i.e(337).then(i.t.bind(i,6337,23)).then((()=>{this.listenScroll()}))},listenScroll(){this.scrollObserver=new IntersectionObserver((t=>{const e=[];if(t.forEach((t=>{const i=t.target.dataset.id-0;t.isIntersecting&&e.push(i)})),this.pauseAllVideo(),e.length){const t=this.videoCards.find((t=>t.id===e[0]));t.ref.playMutedVideo()}}),{threshold:[.8,1],rootMargin:"-100px 0px -100px 0px"})},pauseAllVideo(){this.videoCards.forEach((t=>{t.ref.isPlaying()&&t.ref.pauseVideo()}))},onVideoPlay(t){this.videoCards.forEach((e=>{e.ref.isPlaying()&&e.id!==t&&e.ref.pauseVideo()}))},bindWindowScroll:(0,C.Ds)((function(){const t=document.scrollingElement;this.videoCards.length&&(0===t.scrollTop?(this.pauseAllVideo(),this.videoCards[0].ref.playMutedVideo()):t.scrollTop+t.clientHeight>t.scrollHeight-1&&(this.pauseAllVideo(),this.videoCards[this.videoCards.length-1].ref.playMutedVideo()))}),300),observeDom(){this.$nextTick((()=>{this.videoCards=[],this.list.length&&this.$refs.videoCardRef.forEach((t=>{this.scrollObserver.observe(t.$el),this.videoCards.push({ref:t,id:t.id})}))}))},unobserveDom(){this.$refs.videoCardRef.forEach((t=>{this.scrollObserver.unobserve(t.$el)}))}}},P=T,$=(0,b.Z)(P,s,n,!1,null,null,null),E=$.exports},2325:function(t,e,i){i.d(e,{Ds:function(){return o},LC:function(){return s},tJ:function(){return n}});i(4916);function s(t){return null===t||void 0===t||""===t||isNaN(t)?"":parseFloat(t)}function n(t,e=0){const i=`${t}`;if(/^\.\d{1,}$/.test(i))return s(i);const n=i.match(/(-|\+)?\d+(\.\d+)?/g);return"all"===e?Array.isArray(n)?n.map((t=>s(t))):n:n&&n[e]&&s(n[e])}const o=(t,e)=>{let i=null;return function(...s){null!==i&&clearTimeout(i),i=setTimeout((()=>{t.apply(this,s)}),e)}}},914:function(t,e,i){var s=i(2787),n=i(591),o=i(1750),r=i(9045),l=i(5338),a=(0,s.d)("list"),d=a[0],h=a[1],c=a[2];e["Z"]=d({mixins:[(0,r.X)((function(t){this.scroller||(this.scroller=(0,o.Ob)(this.$el)),t(this.scroller,"scroll",this.check)}))],model:{prop:"loading"},props:{error:Boolean,loading:Boolean,finished:Boolean,errorText:String,loadingText:String,finishedText:String,immediateCheck:{type:Boolean,default:!0},offset:{type:[Number,String],default:300},direction:{type:String,default:"down"}},data:function(){return{innerLoading:this.loading}},updated:function(){this.innerLoading=this.loading},mounted:function(){this.immediateCheck&&this.check()},watch:{loading:"check",finished:"check"},methods:{check:function(){var t=this;this.$nextTick((function(){if(!(t.innerLoading||t.finished||t.error)){var e,i=t.$el,s=t.scroller,o=t.offset,r=t.direction;e=s.getBoundingClientRect?s.getBoundingClientRect():{top:0,bottom:s.innerHeight};var l=e.bottom-e.top;if(!l||(0,n.x)(i))return!1;var a=!1,d=t.$refs.placeholder.getBoundingClientRect();a="up"===r?e.top-d.top<=o:d.bottom-e.bottom<=o,a&&(t.innerLoading=!0,t.$emit("input",!0),t.$emit("load"))}}))},clickErrorText:function(){this.$emit("update:error",!1),this.check()},genLoading:function(){var t=this.$createElement;if(this.innerLoading&&!this.finished)return t("div",{key:"loading",class:h("loading")},[this.slots("loading")||t(l.Z,{attrs:{size:"16"}},[this.loadingText||c("loading")])])},genFinishedText:function(){var t=this.$createElement;if(this.finished){var e=this.slots("finished")||this.finishedText;if(e)return t("div",{class:h("finished-text")},[e])}},genErrorText:function(){var t=this.$createElement;if(this.error){var e=this.slots("error")||this.errorText;if(e)return t("div",{on:{click:this.clickErrorText},class:h("error-text")},[e])}}},render:function(){var t=arguments[0],e=t("div",{ref:"placeholder",key:"placeholder",class:h("placeholder")});return t("div",{class:h(),attrs:{role:"feed","aria-busy":this.innerLoading}},["down"===this.direction?this.slots():e,this.genLoading(),this.genFinishedText(),this.genErrorText(),"up"===this.direction?this.slots():e])}})},7902:function(t,e,i){i(1958),i(2939)},3474:function(t,e,i){i(1958),i(6196),i(3332),i(6742),i(2666)},8286:function(t,e,i){var s=i(2787),n=i(5566),o=i(1750),r=i(4611),l=i(5338),a=(0,s.d)("pull-refresh"),d=a[0],h=a[1],c=a[2],u=50,p=["pulling","loosing","success"];e["Z"]=d({mixins:[r.D],props:{disabled:Boolean,successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:[Number,String],value:{type:Boolean,required:!0},successDuration:{type:[Number,String],default:500},animationDuration:{type:[Number,String],default:300},headHeight:{type:[Number,String],default:u}},data:function(){return{status:"normal",distance:0,duration:0}},computed:{touchable:function(){return"loading"!==this.status&&"success"!==this.status&&!this.disabled},headStyle:function(){if(this.headHeight!==u)return{height:this.headHeight+"px"}}},watch:{value:function(t){this.duration=this.animationDuration,t?this.setStatus(+this.headHeight,!0):this.slots("success")||this.successText?this.showSuccessTip():this.setStatus(0,!1)}},mounted:function(){this.bindTouchEvent(this.$refs.track),this.scrollEl=(0,o.Ob)(this.$el)},methods:{checkPullStart:function(t){this.ceiling=0===(0,o.cx)(this.scrollEl),this.ceiling&&(this.duration=0,this.touchStart(t))},onTouchStart:function(t){this.touchable&&this.checkPullStart(t)},onTouchMove:function(t){this.touchable&&(this.ceiling||this.checkPullStart(t),this.touchMove(t),this.ceiling&&this.deltaY>=0&&"vertical"===this.direction&&((0,n.PF)(t),this.setStatus(this.ease(this.deltaY))))},onTouchEnd:function(){var t=this;this.touchable&&this.ceiling&&this.deltaY&&(this.duration=this.animationDuration,"loosing"===this.status?(this.setStatus(+this.headHeight,!0),this.$emit("input",!0),this.$nextTick((function(){t.$emit("refresh")}))):this.setStatus(0))},ease:function(t){var e=+(this.pullDistance||this.headHeight);return t>e&&(t=t<2*e?e+(t-e)/2:1.5*e+(t-2*e)/4),Math.round(t)},setStatus:function(t,e){var i;i=e?"loading":0===t?"normal":t<(this.pullDistance||this.headHeight)?"pulling":"loosing",this.distance=t,i!==this.status&&(this.status=i)},genStatus:function(){var t=this.$createElement,e=this.status,i=this.distance,s=this.slots(e,{distance:i});if(s)return s;var n=[],o=this[e+"Text"]||c(e);return-1!==p.indexOf(e)&&n.push(t("div",{class:h("text")},[o])),"loading"===e&&n.push(t(l.Z,{attrs:{size:"16"}},[o])),n},showSuccessTip:function(){var t=this;this.status="success",setTimeout((function(){t.setStatus(0)}),this.successDuration)}},render:function(){var t=arguments[0],e={transitionDuration:this.duration+"ms",transform:this.distance?"translate3d(0,"+this.distance+"px, 0)":""};return t("div",{class:h()},[t("div",{ref:"track",class:h("track"),style:e},[t("div",{class:h("head"),style:this.headStyle},[this.genStatus()]),this.slots()])])}})},3796:function(t,e,i){i(1958),i(2939)}}]);